recipe: default.v1
language: vi

pipeline:
  # Sử dụng PhoBERT - BERT được pretrain cho tiếng Việt
  - name: "LanguageModelFeaturizer"
    # Model từ VinAI Research
    model_name: "vinai/phobert-base"
    model_weights: "vinai/phobert-base"
    # Cache model để tránh download lại
    cache_dir: ".cache"
  
  # Trích xuất đặc trưng từ regex (email, số điện thoại, URL...)
  - name: RegexFeaturizer
  
  # Đặc trưng ngữ pháp (parts of speech, etc.)
  - name: LexicalSyntacticFeaturizer
  
  # Đếm tần suất ký tự n-gram (giúp xử lý typo và biến thể)
  - name: CountVectorsFeaturizer
    analyzer: char_wb
    min_ngram: 2
    max_ngram: 5
  
  # DIET Classifier - nhận diện intent và entity
  - name: DIETClassifier
    epochs: 100
    entity_recognition: true
    constrain_similarities: true
    model_confidence: "softmax"
    # Tăng kích thước để tận dụng PhoBERT
    embedding_dimension: 768
    number_of_transformer_layers: 2
    transformer_size: 256
  
  # Chuẩn hóa entity (ví dụ: "HCM" -> "Hồ Chí Minh")
  - name: EntitySynonymMapper
  
  # Response selector cho retrieval intents
  - name: ResponseSelector
    epochs: 100
    constrain_similarities: true
    embedding_dimension: 768
  
  # Xử lý khi bot không chắc chắn
  - name: FallbackClassifier
    threshold: 0.6
    ambiguity_threshold: 0.1

policies:
  # Ghi nhớ các cuộc hội thoại đã thấy
  - name: MemoizationPolicy
  
  # Áp dụng các rules cố định
  - name: RulePolicy
    core_fallback_action_name: "action_default_fallback"
  
  # Dự đoán intent tiếp theo
  - name: UnexpecTEDIntentPolicy
    max_history: 5
    epochs: 100
  
  # Policy chính cho dialogue management
  - name: TEDPolicy
    max_history: 5
    epochs: 100
    constrain_similarities: true